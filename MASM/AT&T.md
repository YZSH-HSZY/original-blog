
## AT&T操作数描述

> 操作数格式:

| 格式         | 操作数值               | 名称               | 样例（GAS = C语言）          |
|--------------|------------------------|--------------------|-----------------------------|
| `$Imm`       | `Imm`                  | 立即数寻址         | `$1 = 1`                    |
| `Ea`         | `R[Ea]`                | 寄存器寻址         | `%eax = eax`                |
| `Imm`        | `M[Imm]`               | 绝对寻址           | `0x104 = *0x104`            |
| `(Ea)`       | `M[R[Ea]]`             | 间接寻址           | `(%eax) = *eax`             |
| `Imm(Ea)`    | `M[Imm+R[Ea]]`         | (基址+偏移量)寻址  | `4(%eax) = *(4+eax)`        |
| `(Ea,Eb)`    | `M[R[Ea]+R[Eb]]`       | 变址               | `(%eax,%ebx) = *(eax+ebx)`  |
| `Imm(Ea,Eb)` | `M[Imm+R[Ea]+R[Eb]]`   | 寻址               | `9(%eax,%ebx) = *(9+eax+ebx)`|
| `(,Ea,s)`    | `M[R[Ea]*s]`           | 伸缩化变址寻址     | `(,%eax,4) = *(eax*4)`      |
| `Imm(,Ea,s)` | `M[Imm+R[Ea]*s]`       | 伸缩化变址寻址     | `0xfc(,%eax,4) = *(0xfc+eax*4)`|
| `(Ea,Eb,s)`  | `M(R[Ea]+R[Eb]*s)`     | 伸缩化变址寻址     | `(%eax,%ebx,4) = *(eax+ebx*4)`|
| `Imm(Ea,Eb,s)`| `M(Imm+R[Ea]+R[Eb]*s)`| 伸缩化变址寻址     | `8(%eax,%ebx,4) = *(8+eax+ebx*4)`|

**注**：M[xx]表示在存储器中xx地址的值，R[xx]表示寄存器xx的值，这种表示方法将寄存器、内存都看出一个大数组的形式。

## 寄存器

#### FS 和 FS_BASE 的关系

- FS(Segment Register) 是一个段寄存器，用于在指令中指定内存地址的段基址
> 在 32 位模式下，段寄存器与偏移量结合形成线性地址。在 64 位模式下，段寄存器的作用被弱化，但仍然可以用于访问线程本地存储（TLS）等特定内存区域。
- FS_BASE(Model-Specific Register, MSR) 是一个模型特定寄存器，存储了 FS 段寄存器的实际基址。
> FS_BASE 存储了 FS 段寄存器指向的内存区域的基址。在 64 位模式下，FS 的实际基址由 FS_BASE 决定。

**注意** 在 64 位模式下，FS 的实际基址由 FS_BASE 决定。例如：
> 当执行 `mov %fs:0x28, %rax` 时，实际访问的内存地址是 `FS_BASE + 0x28`。

> 常见示例:
> gdb 调试时查看 `FS:0x28` 内容, `x /gx $fs_base + 0x28`

## 示例

### objdump反汇编时经常在main中看到 `mov %fs:0x28,%rax`

此命令用于从 `FS 段寄存器` 所指向的内存地址偏移 0x28 处读取数据，并将其存储到 RAX 寄存器 中。

> 一般用于
1. 栈溢出保护（Stack Canary）
    - 在函数开头，从 TLS 中读取一个随机值（栈保护值）并存储到栈上
    - 在函数返回前，检查栈上的值是否被修改，以防止栈溢出攻击
```asm
mov %fs:0x28, %rax  ; 从 TLS 中读取栈保护值
mov %rax, -0x8(%rsp) ; 将栈保护值存储到栈上
```
2. 线程本地变量访问
    - 访问线程特定的数据，例如线程 ID 或其他线程局部变量

